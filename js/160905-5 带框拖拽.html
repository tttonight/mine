<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
 <meta charset="utf-8">
  <title> 拖拽 </title>
  <style>
  #div1 {width:200px;height:200px;background:yellow;position:absolute;}
  .box {border:1px dashed black;position:absolute;}
  </style>
  <script>
  window.onload=function() {
	  var oDiv = document.getElementById("div1");
	  //disX表示鼠标距离窗口的距离
	  var disX=0;
	  var disY=0;
	  //鼠标按下
	  oDiv.onmousedown = function(ev) {
		  var oEvent=ev||event;
		  
		  disX=oEvent.clientX-oDiv.offsetLeft;
		  disY=oEvent.clientY-oDiv.offsetTop;
		  
		  //增加一个框box
		  //*** 错误：容易忽略步骤 appendChild
		  var oBox = document.createElement("div");
		  oBox.className='box';
		  oBox.style.width=oDiv.offsetWidth-2+"px";
		  oBox.style.height=oDiv.offsetHeight-2+'px';
		  //当我摁下时，框正好出现在div出现的位置
		  oBox.style.left=oDiv.offsetLeft+"px";
		  oBox.style.top=oDiv.offsetTop+"px";
		  
		  document.body.appendChild(oBox);
		  
		  document.onmousemove=function(ev) {
			  var oEvent=ev||event;
			  
			  l=oEvent.clientX-disX;
			  t=oEvent.clientY-disY;
			  
			  //控制div不跑出可视区范围
			  if(l<0) {
				  l=0;
			  }else if(l>document.documentElement.clientWidth-oDiv.offsetWidth){
				  //console.log("111");
				  //document.documentElement.clientWidth是可视区范围的宽-div宽
				  l=document.documentElement.clientWidth-oDiv.offsetWidth;
			  }
			  
			  if(t<0) {
				  t=0;
			  }else if(t>document.documentElement.clientHeight-oDiv.offsetHeight) {
				  t=document.documentElement.clientHeight-oDiv.offsetHeight;
			  }
			  oBox.style.left=l+"px";
			  oBox.style.top=t+"px";
			}
		  //鼠标移开
		  oBox.onmouseup=function() {
			  //只需要将移动置为0即可
			  document.onmousemove=null;
			  document.onmousedown=null;
			  oDiv.style.left=l+"px";
			  oDiv.style.top=t+"px";
			  //删除box
			  //注意：应该写的是oBox，不能写‘box’
			  document.body.removeChild(oBox);
		  }
		return false;
	  }
	  
  }
  </script>
 </head>
 <body>
 <div id="div1"></div>
 </body>

</html>
